<script type="text/javascript"> 
  function loadMCQ() {
    var selectType = document.getElementById('selectType').value;

    if (window.XMLHttpRequest) {
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    } else {
        // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            qnss = JSON.parse(xmlhttp.responseText);
            // { id, type, text, ans, labels, values, opt1, opt2 }
            generateMCQ(qnss);
        }
    }
    xmlhttp.open("GET", "json_question.php?type=MODAL" + selectType, true);
    xmlhttp.send();
  }  

  var ans = [];

  function generateMCQ(qnss) {
    // clear content
    var textDiv = document.getElementById('questions');
    if (!textDiv) {
        alert("cannot get questions div!");
        return;
    }
    textDiv.innerHTML = "";

    questionsHtml = '';

    ans = [];
    question_difficulty = 2;

    for (i = 0; i<qnss.length; i++) {
      ans.push(null);

      questionsHtml += '<div class="row" style="margin:0;position: relative;">';

      questionsHtml += '<div class="questions col-sm-6" id="question'+i+'"><p><b>Q'+(i+1)+'</b> '+qnss[i].text+'<span><img class="tickcross" style="display:none"></span></p>';

      options = qnss[i].opt1.split('&');
      shuffle(options);

      for (j = 0; j<options.length; j++) {
        questionsHtml += '<ol><input type="radio" name="q'+i+'" id="q'+qnss[i].id+'_'+j+'" onclick="logMCQ(event)" value="'+options[j]+'" stype="margin: 2px 5px;">'+options[j]+'</input></ol>';
      }

      questionsHtml += '</div>'; // overlay div to disable the question if it is answered correctly
      questionsHtml += '<div class="col-sm-4" id="modal'+i+'" style="display:none"></div><div class="overlay" id="overlay'+i+'" style="display:none" /></div>';
    }

    textDiv.innerHTML = questionsHtml;
  }

  function logMCQ(e) {
    qnsIndex = parseInt(e.target.name.substring(1));
    ans[qnsIndex] = parseInt(qnss[qnsIndex].ans) == parseInt(e.target.value);
  }

  function checkanswer() {
    pass = true;
    wrongQnsNo = '';

    for (i = 0; i<qnss.length; i++) {
      if (ans[i]) {
        document.getElementById("overlay"+i).style.display = "inherit";
        document.getElementById("question"+i).style.color = "lightgray";
      } else {
        pass = false;
        wrongQnsNo += ',' + (i+1);
      }
    }

    if ( pass ) {
      // logPractice("submission", 'null', currentQnsId, 'null', 1, getSQLTimeString(cur), duration);
      $('<div/>').html('ALL CORRECT! Want to practice more? ').dialog({
        resizable: false,
        height:180,
        modal: true,
        buttons: {
          "Next Question": function() {
            loadMCQ();
            $( this ).dialog( "close" );
          },
          Cancel: function() {
            $( this ).dialog( "close" );
          }
        }
      });
    } else {
      // logPractice("submission", 'null', currentQnsId, 'null', 0, getSQLTimeString(cur), duration);
       $('<div/>').html('QUESTION '+ wrongQnsNo.substring(1) +' IS WRONG! Want to ... ').dialog({
        resizable: false,
        modal: true,
        buttons: {
          "Try Again": function() {
              $( this ).dialog( "close" );
          },
          "Make it easier": function() {
              question_difficulty = 0;
              showMoal();
              $( this ).dialog( "close" );
          },
          "Next Question": function() {
              loadModalMCQ();
              $( this ).dialog( "close" );
          }
        }
      });

      if (question_difficulty && question_difficulty == 0)
        $(".ui-dialog-buttonpane button:contains('Make it easier')").button("disable");
    }
  }

  function showMoal() {
    for (var i = 0; i<qnss.length; i++) {
      if (!ans[i]) {
        modalDiv = document.getElementById('modal'+i);

        var labelArr = parsePara(qnss[i].labels);
        var valueJSONArr = [];
        var valueStringArr = qnss[i].values.split('|');
        valueJSONArr.push( parsePara(valueStringArr[0]) );
        valueJSONArr.push( parsePara(valueStringArr[1]) );

        modalDiv.innerHTML = populateModal(qnss[i].type, labelArr, valueJSONArr, false, 0);
        modalDiv.style.display = 'inherit';
      }
    }
  }

  function shuffle(array) {
    var counter = array.length, temp, index;

    // While there are elements in the array
    while (counter > 0) {
        // Pick a random index
        index = Math.floor(Math.random() * counter);

        // Decrease counter by 1
        counter--;

        // And swap the last element with it
        temp = array[counter];
        array[counter] = array[index];
        array[index] = temp;
    }

    return array;
  }
</script>
<style>
ol {
  display: inline-flex;
  width: 50%;
  padding-left: 5px;
}

.overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  z-index: 100000;
}
</style>
<div class="row">
  <div class="col-lg-12">
    <button type="button" class="btn btn-success" onclick="loadMCQ()">Generate Question</button>
    <select id="selectType" class="btn btn-theme dropdown-toggle">
      <option value="%">Random (+,-,x,/)</option>
      <option value="_A%">Addition (+)</option>
      <option value="_S%">Subtraction (-)</option>
      <option value="_M%">Multiplication (x)</option>
      <option value="_D%">Division (/)</option>
    </select>
  </div>
</div>

<div style="font-size: 14px; margin-top: 20px;" id="questions" />
<!-- /.row -->
<div id="answer" style="font-size: 14px;"><button type="button" class="btn btn-success" onclick="checkanswer()">Check Answer</button></div>